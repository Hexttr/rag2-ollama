# Исправление ошибки индексации

## Проблема
Ошибка при индексации документа:
```
openai.OpenAIError: The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable
```

## Причина
Модуль `page_index.py` использует `from .utils import *`, что означает, что функции копируются в пространство имен `page_index`. Когда мы патчим `utils.ChatGPT_API`, это не влияет на уже импортированные функции в `page_index`.

## Решение
1. ✅ Патчинг применен к модулю `utils`
2. ✅ Патчинг применен к модулю `page_index` (критично!)
3. ✅ Патчинг применен к `sys.modules` для всех закэшированных модулей

## Что было исправлено

### 1. `pageindex_ollama.py`
- Добавлен поиск и патчинг модуля `page_index`
- Добавлено логирование для отладки
- Улучшена обработка импортов

### 2. `backend/app/services/pageindex_service.py`
- Добавлен дополнительный патчинг `page_index` модуля после импорта
- Это гарантирует, что все функции используют Ollama

## Перезапуск сервера

**ВАЖНО:** После исправлений нужно перезапустить backend сервер:

```bash
# Остановите текущий сервер (Ctrl+C)
# Затем запустите снова:
cd backend
python run.py
```

## Проверка

После перезапуска попробуйте загрузить документ снова. Ошибка должна быть исправлена.

## Логи

Проверьте логи для подтверждения патчинга:
```bash
# В логах должно быть:
# "Патчинг ChatGPT_API применен к page_index модулю"
# "✅ PageIndex успешно патчен для Ollama"
```


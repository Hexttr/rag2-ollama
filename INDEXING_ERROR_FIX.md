# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞**: `Exception: finish reason: error`

**–ü—Ä–∏—á–∏–Ω–∞**: 
1. Ollama –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `finish_reason: error` –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö
2. `generate_toc_init` –∏ `generate_toc_continue` –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏
3. –í–æ–∑–º–æ–∂–Ω–æ, Ollama –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –º–æ–¥–µ–ª—å

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `finish_reason == 'error'`

–í `generate_toc_init` –∏ `generate_toc_continue`:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `response == "Error"`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `finish_reason == 'error'`
- –í–º–µ—Å—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ `[]`

### 2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ None –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

–í `patched_ChatGPT_API_with_finish_reason`:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `_ollama_client is None`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `"Error", "error"` –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

### 3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ _ollama_settings

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `_ollama_settings = {}`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `_ollama_settings` –ø—Ä–∏ –ø–∞—Ç—á–∏–Ω–≥–µ
- `get_ollama_settings()` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞**
‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ None –¥–æ–±–∞–≤–ª–µ–Ω—ã**
‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ**

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend** - —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Ollama** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
3. **–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç —Å–Ω–æ–≤–∞** - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ª—É—á—à–µ

## –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

–ï—Å–ª–∏ Ollama –≤—Å–µ –µ—â–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø–∞–º—è—Ç–∏, –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ:
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Ollama
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–æ–¥–µ–ª—å `phi3:3.8b` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
- –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–∞–º—è—Ç—å —Å–∏—Å—Ç–µ–º—ã



# Проблемы с загрузкой больших файлов

## Проблема
PDF файл 8 МБ не может загрузиться уже 5 минут.

## Возможные причины

### 1. Индексация занимает много времени
Для больших PDF файлов (8+ МБ) индексация может занимать:
- **10-30 минут** для файлов 5-10 МБ
- **30-60 минут** для файлов 10-20 МБ
- Зависит от количества страниц и сложности документа

### 2. Патчинг не работает
Если патчинг Ollama не применен, индексация падает с ошибкой `api_key`.

### 3. Таймауты
- Загрузка файла: до 5 минут (300 секунд)
- Индексация: без ограничений (выполняется в фоне)

## Что было исправлено

1. ✅ Добавлен таймаут загрузки файла (5 минут)
2. ✅ Добавлена проверка размера файла
3. ✅ Добавлено подробное логирование процесса
4. ✅ Добавлено логирование времени индексации

## Как проверить статус

### 1. Проверьте логи
```bash
# Последние строки логов
tail -f backend/logs/backend.log
```

Ищите сообщения:
- "Начало индексации документа"
- "Индексация завершена за X секунд"
- "Ошибка при индексации"

### 2. Проверьте статус документа через API
```bash
curl http://localhost:8000/api/documents/{document_id}
```

Статусы:
- `uploading` - файл загружается
- `indexing` - идет индексация (может занять много времени!)
- `ready` - индексация завершена
- `error` - произошла ошибка

### 3. Проверьте, что патчинг работает
В логах должно быть:
```
✅ PageIndex успешно патчен для Ollama
Патчинг ChatGPT_API применен к page_index модулю
```

## Рекомендации

### Для больших файлов (8+ МБ):

1. **Подождите дольше** - индексация может занять 10-30 минут
2. **Проверяйте статус через API**, а не ждите ответа загрузки
3. **Используйте WebSocket** для real-time обновлений статуса (если реализовано)

### Если индексация зависла:

1. Проверьте логи на наличие ошибок
2. Проверьте, что Ollama работает: `curl http://localhost:11434/api/tags`
3. Перезапустите сервер и попробуйте снова

### Оптимизация:

Для ускорения индексации можно:
- Уменьшить `PAGEINDEX_MAX_PAGES_PER_NODE` (но это может снизить качество)
- Использовать более быструю модель Ollama
- Обрабатывать документ частями

## Текущие настройки

- Максимальный размер файла: **100 MB**
- Таймаут загрузки: **5 минут (300 секунд)**
- Таймаут индексации: **без ограничений** (выполняется в фоне)
- Модель Ollama: `llama3.1:8b` (можно изменить в `backend/app/core/config.py`)

## Что делать сейчас

1. **Проверьте логи**: `backend/logs/backend.log`
2. **Проверьте статус документа** через API
3. **Подождите еще** - для 8 МБ файла индексация может занять 10-20 минут
4. Если через 30 минут статус все еще `indexing`, проверьте логи на ошибки

